// Language translations
const translations = {
    sk: {
        'main-title': 'SKITRIP PRE INVESTOROV',
        'intro-text': 'Tento zimný retreat nie je firemný teambuilding ani motivačný výlet. Je určený pre vybranú komunitu investorov s majetkom nad 1 milión eur a ľudí, ktorí pôsobia v investičnej oblasti. Ide o komorné, neformálne stretnutie ľudí, ktorých spája podobná životná dynamika a hodnoty.',
        'intro-call-to-action': 'Ak sa v tomto profile vidíš, prosím, odošli žiadosť o účasť. Po jej schválení dostaneš podrobné informácie a pozvánku do uzavretej WhatsApp skupiny.',
        'event-details-title': '1. Základné informácie a priebeh eventu',
        'location-title': 'Miesto',
        'date-title': 'Termín',
        'capacity-title': 'Kapacita',
        'capacity-value': 'max. 50 účastníkov',
        'registration-title': 'Prihlasovanie',
        'registration-deadline': 'do 30. novembra 2025',
        'how-it-works-title': 'Ako to funguje:',
        'how-it-works-1': 'Ak ti vyhovuje termín a miesto, vyplň prosím formulár a po schválení sa ti ozveme.',
        'how-it-works-2': 'Následne si rezervuješ hotel podľa vlastného výberu a na vlastný účet. Odporúčané hotely ti pošleme e-mailom.',
        'how-it-works-3': 'Dôležité: príchod si môžeš naplánovať aj neskôr (v piatok alebo sobotu) a odchod aj skôr – ako chceš.',
        'how-it-works-4': 'Ak chceš, môžeš zobrať partnerku alebo rodinu a cez deň tráviť čas s nimi, a so skupinou byť len večer.',
        'how-it-works-5': 'Doprava je individuálna. Schladming je 3,5 hodiny z Bratislavy a odporúča sa cesta autom.',
        'how-it-works-6': 'Skipasy a požičanie výstroja si rieši každý individuálne na mieste.',
        'how-it-works-7': 'Lyžovať môžeš so skupinou alebo individuálne.',
        'how-it-works-8': 'Večere strávime spoločne a sú hradené G4 Friends.',
        'how-it-works-9': 'Ak máš otázky: <a href="mailto:skitrip@g4.sk">skitrip@g4.sk</a>',
        'application-title': '2. Žiadosť o účasť',
        'application-intro': 'Ak veríš, že zapadneš do tejto skupiny, prosím vyplň nasledujúce údaje:',
        'form-name': 'Meno a priezvisko',
        'form-phone': 'Telefónny kontakt',
        'form-email': 'E-mail',
        'form-website': 'Webstránka alebo LinkedIn profil',
        'form-submit': 'Odoslať žiadosť',
        'after-submission-title': 'Čo sa stane po odoslaní:',
        'after-submission-1': 'Žiadosť interne vyhodnotíme',
        'after-submission-2': 'Ak bude schválená, dostaneš pozvánku e-mailom alebo SMS a pridáme ťa do súkromnej WhatsApp skupiny',
        'after-submission-3': 'Poskytneme ti ďalšie informácie',
        'contact-title': '3. Otázky?',
        'contact-info': 'Napíš na: <a href="mailto:skitrip@g4.sk">skitrip@g4.sk</a>',
        'form-success-title': 'Žiadosť bola úspešne odoslaná!',
        'form-success-message': 'Ďakujeme za záujem. Vaša žiadosť bude vyhodnotená a v prípade schválenia sa Vám ozveme.',
        'form-submitting': 'Odosielam...',
        'nav-info': 'Informácie',
        'nav-application': 'Prihlásenie',
        'nav-contact': 'Kontakt'
    },
    en: {
        'main-title': 'SKITRIP FOR INVESTORS',
        'intro-text': 'This winter retreat is not a corporate team building or motivational trip. It is designed for a select community of investors with assets over 1 million euros and people working in the investment field. It is an intimate, informal meeting of people united by similar life dynamics and values.',
        'intro-call-to-action': 'If you see yourself in this profile, please submit an application. After approval, you will receive detailed information and an invitation to the private WhatsApp group.',
        'event-details-title': '1. Basic information and event schedule',
        'location-title': 'Location',
        'date-title': 'Date',
        'capacity-title': 'Capacity',
        'capacity-value': 'max. 50 participants',
        'registration-title': 'Registration',
        'registration-deadline': 'until November 30, 2025',
        'how-it-works-title': 'How it works:',
        'how-it-works-1': 'If the date and location suit you, please fill out the form and we will contact you after approval.',
        'how-it-works-2': 'Then you book a hotel of your choice at your own expense. We will send you recommended hotels by email.',
        'how-it-works-3': 'Important: you can plan your arrival later (Friday or Saturday) and departure earlier – as you wish.',
        'how-it-works-4': 'If you want, you can bring your partner or family and spend time with them during the day, and be with the group only in the evening.',
        'how-it-works-5': 'Transportation is individual. Schladming is 3.5 hours from Bratislava and driving is recommended.',
        'how-it-works-6': 'Ski passes and equipment rental are handled individually on site.',
        'how-it-works-7': 'You can ski with the group or individually.',
        'how-it-works-8': 'We will have dinner together and it is paid for by G4 Friends.',
        'how-it-works-9': 'If you have questions: <a href="mailto:skitrip@g4.sk">skitrip@g4.sk</a>',
        'application-title': '2. Application for participation',
        'application-intro': 'If you believe you fit into this group, please fill in the following details:',
        'form-name': 'Full name',
        'form-phone': 'Phone contact',
        'form-email': 'Email',
        'form-website': 'Website or LinkedIn profile',
        'form-submit': 'Submit application',
        'after-submission-title': 'What happens after submission:',
        'after-submission-1': 'We will evaluate the application internally',
        'after-submission-2': 'If approved, you will receive an invitation by email or SMS and we will add you to the private WhatsApp group',
        'after-submission-3': 'We will provide you with additional information',
        'contact-title': '3. Questions?',
        'contact-info': 'Write to: <a href="mailto:skitrip@g4.sk">skitrip@g4.sk</a>',
        'form-success-title': 'Application submitted successfully!',
        'form-success-message': 'Thank you for your interest. Your application will be evaluated and we will contact you if approved.',
        'form-submitting': 'Submitting...',
        'nav-info': 'Information',
        'nav-application': 'Application',
        'nav-contact': 'Contact'
    },
    de: {
        'main-title': 'SKITRIP FÜR INVESTOREN',
        'intro-text': 'Dieser Winterretreat ist kein Firmen-Teambuilding oder Motivationsausflug. Er ist für eine ausgewählte Gemeinschaft von Investoren mit einem Vermögen von über 1 Million Euro und Menschen aus dem Investmentbereich bestimmt. Es ist ein intimes, informelles Treffen von Menschen, die ähnliche Lebensdynamik und Werte verbinden.',
        'intro-call-to-action': 'Wenn Sie sich in diesem Profil wiedererkennen, senden Sie bitte eine Bewerbung. Nach der Genehmigung erhalten Sie detaillierte Informationen und eine Einladung zur privaten WhatsApp-Gruppe.',
        'event-details-title': '1. Grundlegende Informationen und Veranstaltungsablauf',
        'location-title': 'Ort',
        'date-title': 'Datum',
        'capacity-title': 'Kapazität',
        'capacity-value': 'max. 50 Teilnehmer',
        'registration-title': 'Anmeldung',
        'registration-deadline': 'bis 30. November 2025',
        'how-it-works-title': 'Wie es funktioniert:',
        'how-it-works-1': 'Wenn Ihnen Datum und Ort zusagen, füllen Sie bitte das Formular aus und wir melden uns nach der Genehmigung bei Ihnen.',
        'how-it-works-2': 'Anschließend buchen Sie ein Hotel Ihrer Wahl auf eigene Kosten. Empfohlene Hotels senden wir Ihnen per E-Mail.',
        'how-it-works-3': 'Wichtig: Sie können Ihre Ankunft auch später planen (Freitag oder Samstag) und früher abreisen – ganz wie Sie möchten.',
        'how-it-works-4': 'Wenn Sie möchten, können Sie Ihren Partner oder Ihre Familie mitbringen und tagsüber Zeit mit ihnen verbringen, und nur abends bei der Gruppe sein.',
        'how-it-works-5': 'Die Anreise erfolgt individuell. Schladming ist 3,5 Stunden von Bratislava entfernt und die Anreise mit dem Auto wird empfohlen.',
        'how-it-works-6': 'Skipässe und Ausrüstungsverleih werden individuell vor Ort geregelt.',
        'how-it-works-7': 'Sie können mit der Gruppe oder individuell Ski fahren.',
        'how-it-works-8': 'Das Abendessen verbringen wir gemeinsam und wird von G4 Friends bezahlt.',
        'how-it-works-9': 'Bei Fragen: <a href="mailto:skitrip@g4.sk">skitrip@g4.sk</a>',
        'application-title': '2. Bewerbung um Teilnahme',
        'application-intro': 'Wenn Sie glauben, dass Sie in diese Gruppe passen, füllen Sie bitte die folgenden Angaben aus:',
        'form-name': 'Vollständiger Name',
        'form-phone': 'Telefon-Kontakt',
        'form-email': 'E-Mail',
        'form-website': 'Website oder LinkedIn-Profil',
        'form-submit': 'Bewerbung senden',
        'after-submission-title': 'Was nach der Einreichung passiert:',
        'after-submission-1': 'Wir bewerten die Bewerbung intern',
        'after-submission-2': 'Bei Genehmigung erhalten Sie eine Einladung per E-Mail oder SMS und wir fügen Sie zur privaten WhatsApp-Gruppe hinzu',
        'after-submission-3': 'Wir stellen Ihnen zusätzliche Informationen zur Verfügung',
        'contact-title': '3. Fragen?',
        'contact-info': 'Schreiben Sie an: <a href="mailto:skitrip@g4.sk">skitrip@g4.sk</a>',
        'form-success-title': 'Bewerbung erfolgreich eingereicht!',
        'form-success-message': 'Vielen Dank für Ihr Interesse. Ihre Bewerbung wird bewertet und wir werden Sie bei Genehmigung kontaktieren.',
        'form-submitting': 'Wird gesendet...',
        'nav-info': 'Informationen',
        'nav-application': 'Bewerbung',
        'nav-contact': 'Kontakt'
    }
};

// Current language
let currentLanguage = 'sk';

// DOM elements
const langButtons = document.querySelectorAll('.lang-btn');
const translatableElements = document.querySelectorAll('[data-translate]');

// Initialize language functionality
document.addEventListener('DOMContentLoaded', function() {
    // Set up language button event listeners
    langButtons.forEach(button => {
        button.addEventListener('click', function() {
            const selectedLang = this.getAttribute('data-lang');
            switchLanguage(selectedLang);
        });
    });

    // Load saved language from localStorage or default to Slovak
    const savedLanguage = localStorage.getItem('selectedLanguage') || 'sk';
    switchLanguage(savedLanguage);
});

// Switch language function
function switchLanguage(language) {
    if (!translations[language]) return;
    
    currentLanguage = language;
    
    // Update active button
    langButtons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-lang') === language) {
            btn.classList.add('active');
        }
    });
    
    // Update all translatable elements
    translatableElements.forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[language][key]) {
            element.innerHTML = translations[language][key];
        }
    });
    
    // Save language preference
    localStorage.setItem('selectedLanguage', language);
    
    // Update document language attribute
    document.documentElement.lang = language;
}

// Form submission handling
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.application-form');
    const submitBtn = document.querySelector('.submit-btn');
    const successDiv = document.getElementById('form-success');
    const afterSubmissionDiv = document.getElementById('after-submission');
    
    // Check if we're returning from a successful form submission
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('success') === 'true') {
        showSuccessMessage();
        // Clean up URL
        window.history.replaceState({}, document.title, window.location.pathname);
    }
    
    if (form) {
        form.addEventListener('submit', function(e) {
            // Prevent double submission
            if (submitBtn.disabled) {
                e.preventDefault();
                return false;
            }
            
            // Update hidden language field
            const languageField = form.querySelector('input[name="_language"]');
            if (languageField) {
                languageField.value = currentLanguage;
            }
            
            // Update subject line based on language
            const subjectField = form.querySelector('input[name="_subject"]');
            if (subjectField) {
                const subjects = {
                    sk: 'G4 Skitrip 2026 - Nová žiadosť o účasť',
                    en: 'G4 Skitrip 2026 - New participation request',
                    de: 'G4 Skitrip 2026 - Neue Teilnahmeanfrage'
                };
                subjectField.value = subjects[currentLanguage] || subjects.sk;
            }
            
            // Update redirect URL to include current page
            const nextField = form.querySelector('input[name="_next"]');
            if (nextField) {
                nextField.value = window.location.origin + window.location.pathname + '?success=true';
            }
            
            // Add loading state to submit button
            submitBtn.innerHTML = '<span class="ski-icon">⏳</span> ' + getTranslation('form-submitting', 'Odosielam...');
            submitBtn.disabled = true;
        });
    }
    
    function showSuccessMessage() {
        if (successDiv && afterSubmissionDiv && form) {
            // Reset form
            form.reset();
            
            // Reset submit button
            if (submitBtn) {
                submitBtn.innerHTML = '<span class="ski-icon">🎿</span> ' + getTranslation('form-submit', 'Odoslať žiadosť');
                submitBtn.disabled = false;
            }
            
            // Show success message
            successDiv.style.display = 'block';
            afterSubmissionDiv.style.display = 'none';
            form.style.display = 'none';
            
            // Scroll to application section first, then to success message
            const applicationSection = document.getElementById('section-application');
            if (applicationSection) {
                // Update nav
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                const appNavItem = document.querySelector('a[href="#section-application"]');
                if (appNavItem) appNavItem.classList.add('active');
                
                // Scroll to section, then show success message
                applicationSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Show success message after scroll completes
                setTimeout(() => {
                    if (successDiv) {
                        successDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 800);
            }
        }
    }
});

// Helper function to get translation
function getTranslation(key, fallback = '') {
    return translations[currentLanguage][key] || fallback;
}

// Card click handlers
document.addEventListener('DOMContentLoaded', function() {
    const locationCard = document.getElementById('location-card');
    const registrationCard = document.getElementById('registration-card');
    
    // Location card - open Google Maps
    if (locationCard) {
        locationCard.addEventListener('click', function() {
            const mapsUrl = 'https://www.google.com/maps/search/Schladming+Planai+Austria';
            window.open(mapsUrl, '_blank');
        });
    }
    
    // Registration card - scroll to application section
    if (registrationCard) {
        registrationCard.addEventListener('click', function() {
            const applicationSection = document.getElementById('section-application');
            if (applicationSection) {
                // Update nav
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                document.querySelector('a[href="#section-application"]').classList.add('active');
                
                applicationSection.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    }
});

// Navigation functionality
document.addEventListener('DOMContentLoaded', function() {
    const navItems = document.querySelectorAll('.nav-item');
    const sections = document.querySelectorAll('.page-section');
    const mainNav = document.querySelector('.main-nav');
    
    // Sticky navigation scroll effect
    let lastScrollTop = 0;
    window.addEventListener('scroll', function() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        if (scrollTop > 100) {
            mainNav.classList.add('scrolled');
        } else {
            mainNav.classList.remove('scrolled');
        }
        
        lastScrollTop = scrollTop;
    });
    
    // Navigation click handlers
    navItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetSection = document.getElementById(targetId);
            
            if (targetSection) {
                // Update active nav item
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
                
                // Scroll to section
                targetSection.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
    
    // Update active nav item on scroll
    const observerOptions = {
        root: null,
        rootMargin: '-20% 0px -60% 0px',
        threshold: 0
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const sectionId = entry.target.id;
                navItems.forEach(nav => {
                    nav.classList.remove('active');
                    if (nav.getAttribute('href') === `#${sectionId}`) {
                        nav.classList.add('active');
                    }
                });
            }
        });
    }, observerOptions);
    
    sections.forEach(section => {
        observer.observe(section);
    });
});

// Add smooth scrolling for other anchor links
document.addEventListener('DOMContentLoaded', function() {
    const links = document.querySelectorAll('a[href^="#"]:not(.nav-item)');
    
    links.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            
            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});